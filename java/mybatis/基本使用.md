[TOC]
#框架
就是软件开发中的一套解决方案,不同的框架解决不同的问题
##好处
提高了开发效率
#三层架构
- 表现层
  展示数据
- 业务层
  处理业务需求
- 持久层
  和数据库交互
![](https://gitee.com/zacharytse/image/raw/master/img/123.png)
#持久层技术解决方案
JDBC技术
- Connection
- PreparedStatement
- ResultSet
Spring的JdbcTemplate
Apache的DBUtils
#Mybatis概述
是一个持久层框架，用java编写
封装了jdbc很多细节，使开发者只需要关注sql语句本身，无需关注注册驱动，创建连接等过程
##ORM
Object Relational Mapping对象关系映射
简单的说：
就是把数据库表和实体类及实体类的属性对应起来
#mybatis在maven中的配置
##导入
在pom文件中，添加dependency
```xml{.line-numbers}
 <!--mybaits-->
    <dependency>
      <groupId>org.mybatis</groupId>
      <artifactId>mybatis</artifactId>
      <version>3.5.5</version>
    </dependency>
    <!--mysql-->
    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.21</version>
    </dependency>
    <!--log4j-->
    <dependency>
      <groupId>log4j</groupId>
      <artifactId>log4j</artifactId>
      <version>1.2.14</version>
    </dependency>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
      <scope>test</scope>
    </dependency>
```
##创建实体类和dao的接口
```java{.line-numbers}
package mybatis.domain;

import java.io.Serializable;
import java.util.Date;

public class User implements Serializable {
    private Integer id;
    private String username;
    private Date birthday;
    private String sex;
    private String address;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public Date getBirthday() {
        return birthday;
    }

    public void setBirthday(Date birthday) {
        this.birthday = birthday;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", birthday=" + birthday +
                ", sex='" + sex + '\'' +
                ", address='" + address + '\'' +
                '}';
    }
}
```
```java{.line-numbers}
package mybatis.dao;

import mybatis.domain.User;

import java.util.List;

public interface IUserDao {
    /**
     * 查询所有操作
     * */
    List<User> findAll();
}
```
##创建Mybatis的主配置文件(SqlMapConfig.xml)
```xml{.line-numbers}
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<!--mybatis主配置文件-->
<configuration>
    <!--配置环境-->
    <environments default="mysql">
        <!--配置id为mysql的环境-->
        <environment id="mysql">
            <!--表示事物的类型-->
            <transactionManager type="JDBC"></transactionManager>
            <!--配置数据源(连接池)-->
            <dataSource type="POOLED">
                <!--配置连接数据库的四个基本信息-->
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/mybatisdb?serverTimezone=UTC"/>
                <property name="username" value="root"/>
                <property name="password" value="123456"/>
            </dataSource>
        </environment>
    </environments>
    <!--指定映射配置文件的位置 映射配置文件指的是每个dao独立的配置文件-->
    <mappers>
        <mapper resource="mybatis/dao/IUserDao.xml"/>
    </mappers>
</configuration>
```
##创建映射配置文件(IUserDao.xml)
```xml{.line-numbers}
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.dao.IUserDao">
    <!--配置查询所有 id是方法名称,resultType指定查询返回的结果类型-->
    <select id="findAll" resultType="mybatis.domain.User">
        select  * from user
    </select>
</mapper>
```
##整体项目结构
![](https://gitee.com/zacharytse/image/raw/master/img/1602940101(1).png)
##一些注意事项
- 创建IUserDao.xml和IUserDao.java时，在mybatis中它把持久层的操作接口名称和映射文件也叫做Mapper
所以IUserDao和IUserMapper是一样的
- 在idea创建目录时和包是不一样的
  包在创建时，com.xxx.dao是三级结构
  目录在创建时，com.xxx.dao是一级目录，com/xxx/dao是三级目录
- mybatis的映射配置文件位置必须和dao接口的包结构相同
- 映射配置文件的mapper标签namespace属性的取值必须是dao接口的全限定类名
- 映射配置文件的操作配置，id属性的取值必须是dao接口的方法名
##测试代码
```java{.line-numbers}
import mybatis.dao.IUserDao;
import mybatis.domain.User;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;
import java.util.List;
public class MybatisTest {
    /**
     * 测试案例
     * **/
    public static void main(String[] args) throws IOException {
        //1.读取配置文件
        InputStream in = Resources.getResourceAsStream("SqlMapConfig.xml");
        //2.创建SqlSessionFactory工厂
        SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
        SqlSessionFactory factory = builder.build(in);
        //3.使用工厂生产一个SqlSession对象
        SqlSession session = factory.openSession();
        //4.使用SqlSession创建Dao接口的代理对象，使用代理来使用dao
        IUserDao userDao = session.getMapper(IUserDao.class);
        //5.使用代理对象执行方法
        List<User> users = userDao.findAll();
        for(User user : users){
            System.out.println(user);
        }
        //6.释放资源
        session.close();
        in.close();
    }
}
```
视频从P9开始看